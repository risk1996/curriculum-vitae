---
import { twMerge } from "tailwind-merge";

interface Props {
  class?: string;
}
---

<div class={twMerge("embla relative", Astro.props.class)}>
  <div class="embla__viewport overflow-hidden">
    <div class="embla__container flex touch-pan-y touch-pinch-zoom">
      <slot />
    </div>
  </div>

  <button
    class="embla__prev absolute bottom-0 left-0 top-0 my-auto flex h-8 w-8 cursor-pointer touch-manipulation appearance-none content-center justify-center rounded-full border-2 border-tapa-50 bg-treehouse-950/70 text-tapa-50 shadow-2xl transition-all disabled:bg-treehouse-800/50 disabled:opacity-50"
  >
    &lt;
  </button>
  <button
    class="embla__next absolute bottom-0 right-0 top-0 my-auto flex h-8 w-8 cursor-pointer touch-manipulation appearance-none content-center justify-center rounded-full border-2 border-tapa-50 bg-treehouse-950/70 text-tapa-50 shadow-2xl transition-all disabled:bg-treehouse-800/50 disabled:opacity-50"
  >
    &gt;
  </button>
</div>

<script>
  import EmblaCarousel from "embla-carousel";

  const nodes = document.querySelectorAll<HTMLElement>(".embla");

  for (const root of nodes) {
    const viewport = root.querySelector<HTMLElement>(".embla__viewport");
    const carousel = EmblaCarousel(viewport ?? root, {
      containScroll: false,
      skipSnaps: true,
    });

    const prev = root.querySelector(".embla__prev");
    if (prev) {
      prev.addEventListener("click", () => carousel.scrollPrev());
      const updatePrevActive = () =>
        carousel.canScrollPrev()
          ? prev.removeAttribute("disabled")
          : prev.setAttribute("disabled", "disabled");
      carousel.on("select", updatePrevActive);
      carousel.on("init", updatePrevActive);
      carousel.on("reInit", updatePrevActive);
      carousel.on("destroy", () => prev.removeAttribute("disabled"));
    }

    const next = root.querySelector(".embla__next");
    if (next) {
      next.addEventListener("click", () => carousel.scrollNext());
      const updateNextActive = () =>
        carousel.canScrollNext()
          ? next.removeAttribute("disabled")
          : next.setAttribute("disabled", "disabled");
      carousel.on("select", updateNextActive);
      carousel.on("init", updateNextActive);
      carousel.on("reInit", updateNextActive);
      carousel.on("destroy", () => next.removeAttribute("disabled"));
    }
  }
</script>
